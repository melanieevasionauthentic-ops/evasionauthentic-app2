
<!DOCTYPE html><html lang="fr"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Marchés • Evasion Authentic</title>
<link rel="icon" href="../assets/favicon.png" type="image/png">
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="../css/style.css"/></head>
<body>
<header class="topbar"><div class="brand"><a href="../index.html"><img src="../assets/logo.svg" class="logo" alt="Evasion Authentic"/></a></div></header>
<main>
  <h1>Marchés de Majorque</h1>
  <div class="map-wrap"><div id="map" class="map"></div><button id="enable-map" class="map-overlay">Activer la carte</button></div>
  <div class="filters">
    <label>Jour <select id="jour"><option value="Tous">Tous</option><option>Lundi</option><option>Mardi</option><option>Mercredi</option><option>Jeudi</option><option>Vendredi</option><option>Samedi</option><option>Dimanche</option></select></label>
    <label>Zone <select id="zone"><option value="Toutes">Toutes</option><option>Nord</option><option>Est</option><option>Sud</option><option>Ouest</option><option>Tramuntana</option><option>Intérieur</option></select></label>
    <button id="today">Aujourd'hui</button>
  </div>
  <div id="list" class="cards"></div>
</main>
<footer class="footer"><small>© Evasion Authentic — WhatsApp +34 618 688 798</small></footer>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="../js/data.js"></script>
<script src="../js/common.js"></script>
<script>
const map=L.map('map',{scrollWheelZoom:false}).setView([39.66,3.0],9);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OpenStreetMap'}).addTo(map);
const layer=L.layerGroup().addTo(map); guardMap(map, document.getElementById('enable-map'));
const list=document.getElementById('list'); const j=document.getElementById('jour'), z=document.getElementById('zone'), td=document.getElementById('today');
function jf(d){return ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'][d]}
function draw(){const jfilt=j.value, zf=z.value; const data=window.APP_DATA.markets.filter(m=>(jfilt==='Tous'||m.jour===jfilt)&&(zf==='Toutes'||m.zone===zf)); list.innerHTML=data.map(m=>`<div class="card"><div class="pad"><h3>${m.ville}</h3><div class="badge">${m.jour}</div><div class="badge">${m.zone}</div></div></div>`).join(''); layer.clearLayers(); data.forEach(m=>{const c=window.APP_DATA.coords[m.ville]||window.APP_DATA.coords[m.ville+' (Alcúdia)']||window.APP_DATA.coords[m.ville+' (Pollença)']; if(!c) return; L.marker([c.lat,c.lng]).addTo(layer).bindPopup(`<strong>${m.ville}</strong><br>${m.jour} — ${m.zone}`);});}
j.onchange=z.onchange=draw; td.onclick=()=>{j.value=jf(new Date().getDay()); draw();}; draw();
</script>
</body></html>
